{
  "name": "Edge Node Statistics",
  "description": "Data Activity (events/bytes in and out over time per host) and top 10 Edge nodes by bytes in.",
  "created": 1769600000000,
  "modified": 1769600000000,
  "createdBy": "pack",
  "modifiedBy": "pack",
  "displayCreatedBy": "Cribl Search Inventory Pack",
  "displayModifiedBy": "Cribl Search Inventory Pack",
  "schedule": {
    "enabled": false,
    "cronSchedule": "0 0 * * *",
    "tz": "UTC",
    "keepLastN": 2
  },
  "groups": {},
  "elements": [
    {
      "id": "ens-time-range",
      "type": "input.timerange",
      "variant": "input",
      "title": "Time Range",
      "inputId": "time_range",
      "config": {
        "defaultValue": {
          "earliest": "-1h",
          "latest": "now",
          "timezone": "local"
        }
      },
      "layout": { "x": 0, "y": 0, "w": 2, "h": 2 }
    },
    {
      "id": "ens-fleet-dropdown",
      "type": "input.dropdown",
      "variant": "input",
      "title": "Fleet",
      "inputId": "fleet",
      "config": { "defaultValue": "*", "field": "id" },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_groups} isFleet==true | summarize by id",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$"
      },
      "layout": { "x": 2, "y": 0, "w": 2, "h": 2 }
    },
    {
      "id": "ens-markdown",
      "type": "markdown.default",
      "variant": "markdown",
      "config": {
        "markdown": "# Data Activity\n\nEvents and bytes in/out over time, one line per host. Tables below show top 10 Edge nodes by bytes in and by events in.",
        "axis": {}
      },
      "layout": { "x": 0, "y": 2, "w": 12, "h": 1 }
    },
    {
      "id": "ens-chart-in-events",
      "type": "chart.line",
      "variant": "chart",
      "title": "Events In over time",
      "config": {
        "axis": { "x": { "field": "_time", "title": "Time" }, "y": { "fields": ["in_events"], "title": "Events In" } },
        "splitViewBy": "host"
      },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | project _time, host=coalesce(info.hostname, id), in_events=coalesce(lastMetrics[\"total.in_events\"], inEvents, in_events) | summarize in_events=max(in_events) by bin(_time, 1h), host | sort by _time asc",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$"
      },
      "layout": { "x": 0, "y": 3, "w": 6, "h": 4 }
    },
    {
      "id": "ens-chart-out-events",
      "type": "chart.line",
      "variant": "chart",
      "title": "Events Out over time",
      "config": {
        "axis": { "x": { "field": "_time", "title": "Time" }, "y": { "fields": ["out_events"], "title": "Events Out" } },
        "splitViewBy": "host"
      },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | project _time, host=coalesce(info.hostname, id), out_events=coalesce(lastMetrics[\"total.out_events\"], outEvents, out_events) | summarize out_events=max(out_events) by bin(_time, 1h), host | sort by _time asc",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$"
      },
      "layout": { "x": 6, "y": 3, "w": 6, "h": 4 }
    },
    {
      "id": "ens-chart-in-bytes",
      "type": "chart.line",
      "variant": "chart",
      "title": "Bytes In over time",
      "config": {
        "axis": { "x": { "field": "_time", "title": "Time" }, "y": { "fields": ["in_bytes"], "title": "Bytes In" } },
        "splitViewBy": "host"
      },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | project _time, host=coalesce(info.hostname, id), in_bytes=coalesce(lastMetrics[\"total.in_bytes\"], inBytes, in_bytes) | summarize in_bytes=max(in_bytes) by bin(_time, 1h), host | sort by _time asc",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$"
      },
      "layout": { "x": 0, "y": 7, "w": 6, "h": 4 }
    },
    {
      "id": "ens-chart-out-bytes",
      "type": "chart.line",
      "variant": "chart",
      "title": "Bytes Out over time",
      "config": {
        "axis": { "x": { "field": "_time", "title": "Time" }, "y": { "fields": ["out_bytes"], "title": "Bytes Out" } },
        "splitViewBy": "host"
      },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | project _time, host=coalesce(info.hostname, id), out_bytes=coalesce(lastMetrics[\"total.out_bytes\"], outBytes, out_bytes) | summarize out_bytes=max(out_bytes) by bin(_time, 1h), host | sort by _time asc",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$"
      },
      "layout": { "x": 6, "y": 7, "w": 6, "h": 4 }
    },
    {
      "id": "ens-top10-table",
      "type": "list.table",
      "title": "Top 10 Edge nodes by bytes in",
      "config": {},
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | sort by coalesce(lastMetrics[\"total.in_bytes\"], inBytes, in_bytes, 0) desc, lastMsgTime desc | take 10 | project host=coalesce(info.hostname, id), id, in_bytes=coalesce(lastMetrics[\"total.in_bytes\"], inBytes, in_bytes), out_bytes=coalesce(lastMetrics[\"total.out_bytes\"], outBytes, out_bytes), lastMsgTime",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$"
      },
      "layout": { "x": 0, "y": 11, "w": 12, "h": 6 }
    },
    {
      "id": "ens-top10-events-table",
      "type": "list.table",
      "title": "Top 10 Edge nodes by events in",
      "config": {},
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | sort by coalesce(lastMetrics[\"total.in_events\"], inEvents, in_events, 0) desc, lastMsgTime desc | take 10 | project host=coalesce(info.hostname, id), id, in_events=coalesce(lastMetrics[\"total.in_events\"], inEvents, in_events), out_events=coalesce(lastMetrics[\"total.out_events\"], outEvents, out_events), lastMsgTime",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$"
      },
      "layout": { "x": 0, "y": 17, "w": 12, "h": 6 }
    }
  ]
}
