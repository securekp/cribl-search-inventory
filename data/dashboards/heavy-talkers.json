{
  "name": "Heavy Talkers for Edge",
  "description": "Top Edge nodes by throughput (in/out events and bytes). Filter by Fleet.",
  "created": 1769600000000,
  "modified": 1769600000000,
  "createdBy": "pack",
  "modifiedBy": "pack",
  "displayCreatedBy": "Cribl Search Inventory Pack",
  "displayModifiedBy": "Cribl Search Inventory Pack",
  "schedule": { "enabled": false, "cronSchedule": "0 * * * *", "tz": "UTC", "keepLastN": 2 },
  "groups": {},
  "elements": [
    {
      "id": "ht-time-range",
      "type": "input.timerange",
      "variant": "input",
      "title": "Time Range",
      "inputId": "time_range",
      "config": { "defaultValue": { "earliest": "-1h", "latest": "now", "timezone": "local" } },
      "layout": { "x": 0, "y": 0, "w": 3, "h": 2 }
    },
    {
      "id": "ht-fleet-dropdown",
      "type": "input.dropdown",
      "variant": "input",
      "title": "Fleet",
      "inputId": "fleet",
      "config": { "defaultValue": "*", "field": "id" },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_groups} isFleet==true | summarize by id",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$",
        "timezone": "$time_range.timezone$",
        "timeRangeInputId": "time_range"
      },
      "layout": { "x": 3, "y": 0, "w": 3, "h": 2 }
    },
    {
      "id": "ht-markdown",
      "type": "markdown.default",
      "variant": "markdown",
      "config": {
        "markdown": "# Heavy Talkers for Edge\n\nView **Edge nodes** with the highest throughput by fleet. Use **Time Range** and **Fleet** (choose * for all fleets). Data from **cribl_worker_metrics** (Leader `master/workers`). Charts show throughput over time when the dataset is refreshed; the table shows top nodes by outbound events.\n",
        "axis": {}
      },
      "layout": { "x": 0, "y": 2, "w": 12, "h": 2 }
    },
    {
      "id": "ht-chart-in-events",
      "type": "chart.line",
      "variant": "chart",
      "title": "Inbound events over time",
      "config": { "axis": { "x": { "field": "_time", "title": "Time" }, "y": { "fields": ["in_events"], "title": "Inbound events" } }, "splitBy": "instance" },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | project _time, instance=id, in_events=coalesce(lastMetrics[\"total.in_events\"], inEvents, in_events) | summarize in_events=max(in_events) by bin(_time, 1h), instance | sort by _time asc",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$",
        "timezone": "$time_range.timezone$",
        "timeRangeInputId": "time_range"
      },
      "layout": { "x": 0, "y": 4, "w": 6, "h": 4 }
    },
    {
      "id": "ht-chart-out-events",
      "type": "chart.line",
      "variant": "chart",
      "title": "Outbound events over time",
      "config": { "axis": { "x": { "field": "_time", "title": "Time" }, "y": { "fields": ["out_events"], "title": "Outbound events" } }, "splitBy": "instance" },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | project _time, instance=id, out_events=coalesce(lastMetrics[\"total.out_events\"], outEvents, out_events) | summarize out_events=max(out_events) by bin(_time, 1h), instance | sort by _time asc",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$",
        "timezone": "$time_range.timezone$",
        "timeRangeInputId": "time_range"
      },
      "layout": { "x": 6, "y": 4, "w": 6, "h": 4 }
    },
    {
      "id": "ht-chart-in-bytes",
      "type": "chart.line",
      "variant": "chart",
      "title": "Inbound bytes over time",
      "config": { "axis": { "x": { "field": "_time", "title": "Time" }, "y": { "fields": ["in_bytes"], "title": "Inbound bytes" } }, "splitBy": "instance" },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | project _time, instance=id, in_bytes=coalesce(lastMetrics[\"total.in_bytes\"], inBytes, in_bytes) | summarize in_bytes=max(in_bytes) by bin(_time, 1h), instance | sort by _time asc",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$",
        "timezone": "$time_range.timezone$",
        "timeRangeInputId": "time_range"
      },
      "layout": { "x": 0, "y": 8, "w": 6, "h": 4 }
    },
    {
      "id": "ht-chart-out-bytes",
      "type": "chart.line",
      "variant": "chart",
      "title": "Outbound bytes over time",
      "config": { "axis": { "x": { "field": "_time", "title": "Time" }, "y": { "fields": ["out_bytes"], "title": "Outbound bytes" } }, "splitBy": "instance" },
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | project _time, instance=id, out_bytes=coalesce(lastMetrics[\"total.out_bytes\"], outBytes, out_bytes) | summarize out_bytes=max(out_bytes) by bin(_time, 1h), instance | sort by _time asc",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$",
        "timezone": "$time_range.timezone$",
        "timeRangeInputId": "time_range"
      },
      "layout": { "x": 6, "y": 8, "w": 6, "h": 4 }
    },
    {
      "id": "ht-edge-table",
      "type": "list.table",
      "title": "Edge nodes (heavy talkers)",
      "config": {},
      "search": {
        "type": "inline",
        "query": "${cribl_worker_metrics} (group==\"$fleet\" or \"$fleet\"==\"*\") | sort by coalesce(lastMetrics[\"total.out_events\"], outEvents, out_events, 0) desc, lastMsgTime desc | take 25 | project group, id, hostname=info.hostname, in_events=coalesce(lastMetrics[\"total.in_events\"], inEvents, in_events), out_events=coalesce(lastMetrics[\"total.out_events\"], outEvents, out_events), in_bytes=coalesce(lastMetrics[\"total.in_bytes\"], inBytes, in_bytes), out_bytes=coalesce(lastMetrics[\"total.out_bytes\"], outBytes, out_bytes), lastMsgTime, status",
        "earliest": "$time_range.earliest$",
        "latest": "$time_range.latest$",
        "timezone": "$time_range.timezone$",
        "timeRangeInputId": "time_range"
      },
      "layout": { "x": 0, "y": 12, "w": 12, "h": 8 }
    }
  ]
}
